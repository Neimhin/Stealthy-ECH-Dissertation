
\chapter{Design}
\label{chap:Design}

\section{Considerations for split-mode SECH}
[ ] reminder: what is split-mode?

\cite{esni} describe two modes of operation for ECH, shared mode and split mode. In shared mode there is a single server which performs the ECH decryption {\em and} terminates the TLS connection, whereas in split mode there is a client-facing server that performs ECH decryption and which proxies the remaining TLS traffic to and from a backend server which terminates the TLS connection. For ECH each server is `aware' of its role in the ongoing connection. The server can have a different role for different connections, but within the context of a single connection the server determines its role based on the \var{type} field of the received \var{encrypted\_client\_hello} extension, if the \var{type} is outer then the server is the client-facing server, if it is \var{inner} the server is the backend server.

[ ] motivations for split-mode: 1. distribute workload, 2. enhanced privacy for backend server (client-facing server can't see application traffic)

[ ] reasons for hesitance in deploying split-mode: 1. low incentive for large providers (the provider loses access to the application data and parts of the handshake), 2. more complex to deploy/maintain/configure than shared-mode

\section{Naïve idea: incorporate shared secret in key-schedule}
Looking at a naïve design assuming a shared secret $s$ known to client, client-facing server, and backend server, the client uses AEAD to create a cipher text of the inner servername and encodes the cipher text (including AEAD nonce and tag) in some cover fields of the \var{ClientHello}. An attacker can copy and paste the full cipher text

% Sequence diagram for a proposed stealthy ECH protocol. In this sequence diagram SECH is accepted by the server. Dotted lines indicate an exact forwarding of the message by the client-facing server. Fields in angle brackets ($\langle\ldots\rangle$) are encrypted under a special SECH-specific key and hidden in the message stealthily.
%\includescalefigure{fig:sech-split-mode-accept}{}{1}{figure/sech-split-mode-accept.pdf}

\begin{figure}[htb]
\centering
\includegraphics[width=\linewidth]{figure/sech-split-mode-accept.pdf}
\captionsetup{width=.8\linewidth} 
\caption[]{Sequence diagram for a successful SECH split-mode handshake.}
\label{fig:sech-split-mode-accept}
\end{figure}

\section{SECH 1: Secretless Stealthy Encoding}
\subsection{Motivations and Deployment Scenarios}

[ ] more properly should be called just `stealthy SNI' or `stealthy CH', because this version does not use encryption

[ ] very low coordination/infrastructure requirements to get this working

[ ] SECH.1 does **not** offer confidentiality of the SNI or ALPN, aim here is purely censorship circumvention, not privacy

[ ] as a censorship circumvention method this can be easily detected and prevented

[ ] possibly useful ephemerally and at a small scale

[ ] circumvention in depth: use lots of different circumvention methods (including this insecure one) in order to increase the cost of censorship
\subsection{Design}
\subsection{Implementation Notes}


\input{section/design-sech-2}

\section{SECH 3}
\subsection{Motivations and Deployment Scenarios}
\subsection{Design}
\subsection{Implementation Notes}
\section{SECH 4}
\subsection{Motivations and Deployment Scenarios}
\subsection{Design}
\subsection{Implementation Notes}

\input{section/design-sech-5}

\section{SECH 6: TLS over TLS}
\subsection{Motivations and Deployment Scenarios}
\subsection{Design}
\subsection{Implementation Notes}


% At the beginning of each chapter, a description should introduce the reader to the content of the chapter. The description should explain to the reader the layout of the chapter, the contribution that the chapter makes to the overall dissertation and the contribution of the individual sections towards the overall chapter.


% \section{Problem Formulation}
% \label{sec:ProblemFormulation}

% This section should provide the reader with an overall description of the problem that will be addressed in the dissertation. In contrast to a generic discussion of the dissertation topic in the Introduction chapter, this section should provide a detailed discussion of the problem that has been identified based on the existing work that has been discussed in the preceeding chapter. 

% In some dissertations, it may make sense to convert this section into a short chapter of its own which follows the discussion of the existing work and preceeds the discussion of the work of the dissertation.

% \subsection{Identified Challenges}
% This section should present a short description of the gaps in the existing work and the relationship of these gaps to the work described in this dissertation.

% \subsection{Proposed Work}
% This section should provide a thorough description of the problem and an overview of the work proposed to address the problem.


% \section{Overview of the Design}
% \label{sec:OverviewOfDesign}
% A description of the approach that addresses the problem identified above.


% \section{Summary}
% \label{sec:SummaryDesign}

% Every chapter aside from the first and last chapter should conclude with a summary. 
